{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/oscar/OneDrive/Escritorio/Redes de computadoras III/Proyecto Final/ProyectoRedesIII/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { FormControl, Validators, FormArray } from '@angular/forms';\nimport { debounceTime } from 'rxjs/operators';\nlet NewBusinessComponent = class NewBusinessComponent {\n  //Asignación de tipo de cuenta\n  constructor(formBuilder, userService, businessService, sanitizer) {\n    var _this = this;\n\n    this.formBuilder = formBuilder;\n    this.userService = userService;\n    this.businessService = businessService;\n    this.sanitizer = sanitizer;\n    this.userId = \"\";\n    this.typeContactList = [\"Teléfono\", \"e-mail\", \"Website\", \"Facebook\", \"Twitter\", \"Instagram\"];\n    this.canAddContact = false; //Variable que deshabilita el botón de añadir contacto\n\n    this.typeList = [];\n    this.contactList = [];\n    this.categoriesList = [];\n    this.categoriesIdList = [];\n    this.existeName = false;\n    this.options = {\n      types: ['address'],\n      componentRestrictions: {\n        country: 'MX'\n      }\n    };\n    this.latitude = 19.4978;\n    this.longitude = -99.1269;\n    this.zoom = 4; //Convierte la imagen a base 64 para poder visualizarla \n\n    this.extraerBase64 = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* ($event) {\n        return new Promise((resolve, reject) => {\n          try {\n            const unsafeImg = window.URL.createObjectURL($event);\n\n            const image = _this.sanitizer.bypassSecurityTrustUrl(unsafeImg);\n\n            const reader = new FileReader();\n            reader.readAsDataURL($event);\n\n            reader.onload = () => {\n              resolve({\n                base: reader.result\n              });\n            };\n\n            reader.onerror = error => {\n              resolve({\n                base: null\n              });\n            };\n\n            return;\n          } catch (e) {\n            return null;\n          }\n        });\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    this.buildForm();\n  }\n\n  ngOnInit() {\n    if (localStorage.getItem('sesion')) {\n      this.setCurrentLocation();\n      const sesion = localStorage.getItem('sesion');\n      let value = \" \" + sesion + \" \";\n      this.userId = JSON.parse(value)[\"id\"];\n      this.userService.getUser(JSON.parse(value)[\"id\"]).subscribe({\n        next: v => {\n          this.user = v;\n          this.fullname = this.user.name + \" \" + this.user.second_name + \" \" + this.user.third_name;\n        },\n        error: e => {\n          console.log(e);\n        },\n        complete: () => console.info('complete')\n      });\n      this.businessService.categoriesList().subscribe({\n        next: v => {\n          for (var i = 0; i < Object.keys(JSON.parse(JSON.stringify(v))).length; i++) {\n            this.categoriesList.push(JSON.parse(JSON.stringify(v))[i].category);\n            this.categoriesIdList.push(JSON.parse(JSON.stringify(v))[i].id);\n          }\n        },\n        error: e => {\n          console.log(e);\n        },\n        complete: () => console.info('complete')\n      });\n    } else {\n      location.replace('');\n    }\n  }\n\n  handleAddressChange(address) {\n    this.latitude = address.geometry.location.lat();\n    this.longitude = address.geometry.location.lng();\n    this.zoom = 15;\n  }\n\n  setCurrentLocation() {\n    navigator.geolocation.getCurrentPosition(position => {\n      this.latitude = position.coords.latitude;\n      this.longitude = position.coords.longitude;\n      this.zoom = 15;\n    }, err => {\n      console.log(err.message);\n    });\n  }\n\n  buildForm() {\n    this.form = this.formBuilder.group({\n      name: ['', [Validators.required]],\n      description: ['', [Validators.required]],\n      id_category: ['', [Validators.required]],\n      type: [''],\n      contact: [''],\n      typeList: new FormArray([], [Validators.required]),\n      contactList: new FormArray([], [Validators.required]),\n      latitude: ['', [Validators.required]],\n      longitude: ['', [Validators.required]],\n      address: ['', [Validators.required]],\n      photo: [null]\n    }); //Evaluación reactiva\n\n    this.form.valueChanges.pipe(debounceTime(500)).subscribe(value => {\n      if (value.type == \"\" || value.contact == \"\") {\n        this.canAddContact = false;\n      } else {\n        this.canAddContact = true;\n      }\n    });\n  }\n\n  addContact() {\n    var _a, _b;\n\n    const typeArray = this.form.get('typeList');\n    const contactArray = this.form.get('contactList');\n    typeArray.push(new FormControl(this.form.value.type));\n    contactArray.push(new FormControl(this.form.value.contact));\n    this.canAddContact = false;\n    this.typeList.push(this.form.value.type);\n    this.contactList.push(this.form.value.contact);\n    (_a = this.form.get('type')) === null || _a === void 0 ? void 0 : _a.setValue(\"\");\n    (_b = this.form.get('contact')) === null || _b === void 0 ? void 0 : _b.setValue(\"\");\n    this.type.nativeElement.value = \"\";\n    this.contact.nativeElement.value = \"\";\n  }\n\n  deleteContact(i) {\n    this.typeList.splice(i, 1);\n    this.contactList.splice(i, 1);\n    const typeArray = this.form.get('typeList');\n    const contactArray = this.form.get('contactList');\n    typeArray.removeAt(i);\n    contactArray.removeAt(i);\n  } //Visualización de la imagen\n\n\n  capturarFile(event) {\n    const archivoCapturado = event.target.files[0];\n    this.file = event.target.files[0]; //Se alamcena la imagen en el atributo file\n\n    this.extraerBase64(archivoCapturado).then(imagen => {\n      this.previsualizacion = imagen.base;\n    });\n  }\n\n  sendbusiness(event) {\n    event.preventDefault();\n    const value = this.form.value;\n  }\n\n};\n\n__decorate([ViewChild('type')], NewBusinessComponent.prototype, \"type\", void 0);\n\n__decorate([ViewChild('contact')], NewBusinessComponent.prototype, \"contact\", void 0);\n\n__decorate([ViewChild(\"placesRef\")], NewBusinessComponent.prototype, \"placesRef\", void 0);\n\nNewBusinessComponent = __decorate([Component({\n  selector: 'app-new-business',\n  templateUrl: './new-business.component.html',\n  styleUrls: ['./new-business.component.css']\n})], NewBusinessComponent);\nexport { NewBusinessComponent };","map":{"version":3,"sources":["C:/Users/oscar/OneDrive/Escritorio/Redes de computadoras III/Proyecto Final/ProyectoRedesIII/client/src/app/components/new-business/new-business.component.ts"],"names":["__decorate","Component","ViewChild","FormControl","Validators","FormArray","debounceTime","NewBusinessComponent","constructor","formBuilder","userService","businessService","sanitizer","userId","typeContactList","canAddContact","typeList","contactList","categoriesList","categoriesIdList","existeName","options","types","componentRestrictions","country","latitude","longitude","zoom","extraerBase64","$event","Promise","resolve","reject","unsafeImg","window","URL","createObjectURL","image","bypassSecurityTrustUrl","reader","FileReader","readAsDataURL","onload","base","result","onerror","error","e","buildForm","ngOnInit","localStorage","getItem","setCurrentLocation","sesion","value","JSON","parse","getUser","subscribe","next","v","user","fullname","name","second_name","third_name","console","log","complete","info","i","Object","keys","stringify","length","push","category","id","location","replace","handleAddressChange","address","geometry","lat","lng","navigator","geolocation","getCurrentPosition","position","coords","err","message","form","group","required","description","id_category","type","contact","photo","valueChanges","pipe","addContact","_a","_b","typeArray","get","contactArray","setValue","nativeElement","deleteContact","splice","removeAt","capturarFile","event","archivoCapturado","target","files","file","then","imagen","previsualizacion","sendbusiness","preventDefault","prototype","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport { Component, ViewChild } from '@angular/core';\r\nimport { FormControl, Validators, FormArray } from '@angular/forms';\r\nimport { debounceTime } from 'rxjs/operators';\r\nlet NewBusinessComponent = class NewBusinessComponent {\r\n    //Asignación de tipo de cuenta\r\n    constructor(formBuilder, userService, businessService, sanitizer) {\r\n        this.formBuilder = formBuilder;\r\n        this.userService = userService;\r\n        this.businessService = businessService;\r\n        this.sanitizer = sanitizer;\r\n        this.userId = \"\";\r\n        this.typeContactList = [\"Teléfono\", \"e-mail\", \"Website\", \"Facebook\", \"Twitter\", \"Instagram\"];\r\n        this.canAddContact = false; //Variable que deshabilita el botón de añadir contacto\r\n        this.typeList = [];\r\n        this.contactList = [];\r\n        this.categoriesList = [];\r\n        this.categoriesIdList = [];\r\n        this.existeName = false;\r\n        this.options = {\r\n            types: ['address'],\r\n            componentRestrictions: { country: 'MX' }\r\n        };\r\n        this.latitude = 19.4978;\r\n        this.longitude = -99.1269;\r\n        this.zoom = 4;\r\n        //Convierte la imagen a base 64 para poder visualizarla \r\n        this.extraerBase64 = async ($event) => new Promise((resolve, reject) => {\r\n            try {\r\n                const unsafeImg = window.URL.createObjectURL($event);\r\n                const image = this.sanitizer.bypassSecurityTrustUrl(unsafeImg);\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL($event);\r\n                reader.onload = () => {\r\n                    resolve({\r\n                        base: reader.result\r\n                    });\r\n                };\r\n                reader.onerror = error => {\r\n                    resolve({\r\n                        base: null\r\n                    });\r\n                };\r\n                return;\r\n            }\r\n            catch (e) {\r\n                return null;\r\n            }\r\n        });\r\n        this.buildForm();\r\n    }\r\n    ngOnInit() {\r\n        if (localStorage.getItem('sesion')) {\r\n            this.setCurrentLocation();\r\n            const sesion = localStorage.getItem('sesion');\r\n            let value = \" \" + sesion + \" \";\r\n            this.userId = JSON.parse(value)[\"id\"];\r\n            this.userService.getUser(JSON.parse(value)[\"id\"])\r\n                .subscribe({\r\n                next: (v) => {\r\n                    this.user = v;\r\n                    this.fullname = this.user.name + \" \" + this.user.second_name + \" \" + this.user.third_name;\r\n                },\r\n                error: (e) => { console.log(e); },\r\n                complete: () => console.info('complete')\r\n            });\r\n            this.businessService.categoriesList()\r\n                .subscribe({\r\n                next: (v) => {\r\n                    for (var i = 0; i < Object.keys(JSON.parse(JSON.stringify(v))).length; i++) {\r\n                        this.categoriesList.push(JSON.parse(JSON.stringify(v))[i].category);\r\n                        this.categoriesIdList.push(JSON.parse(JSON.stringify(v))[i].id);\r\n                    }\r\n                },\r\n                error: (e) => { console.log(e); },\r\n                complete: () => console.info('complete')\r\n            });\r\n        }\r\n        else {\r\n            location.replace('');\r\n        }\r\n    }\r\n    handleAddressChange(address) {\r\n        this.latitude = address.geometry.location.lat();\r\n        this.longitude = address.geometry.location.lng();\r\n        this.zoom = 15;\r\n    }\r\n    setCurrentLocation() {\r\n        navigator.geolocation.getCurrentPosition(position => {\r\n            this.latitude = position.coords.latitude;\r\n            this.longitude = position.coords.longitude;\r\n            this.zoom = 15;\r\n        }, err => { console.log(err.message); });\r\n    }\r\n    buildForm() {\r\n        this.form = this.formBuilder.group({\r\n            name: ['', [Validators.required]],\r\n            description: ['', [Validators.required]],\r\n            id_category: ['', [Validators.required]],\r\n            type: ['',],\r\n            contact: ['',],\r\n            typeList: new FormArray([], [Validators.required]),\r\n            contactList: new FormArray([], [Validators.required]),\r\n            latitude: ['', [Validators.required]],\r\n            longitude: ['', [Validators.required]],\r\n            address: ['', [Validators.required]],\r\n            photo: [null,]\r\n        });\r\n        //Evaluación reactiva\r\n        this.form.valueChanges\r\n            .pipe(debounceTime(500))\r\n            .subscribe(value => {\r\n            if (value.type == \"\" || value.contact == \"\") {\r\n                this.canAddContact = false;\r\n            }\r\n            else {\r\n                this.canAddContact = true;\r\n            }\r\n        });\r\n    }\r\n    addContact() {\r\n        var _a, _b;\r\n        const typeArray = this.form.get('typeList');\r\n        const contactArray = this.form.get('contactList');\r\n        typeArray.push(new FormControl(this.form.value.type));\r\n        contactArray.push(new FormControl(this.form.value.contact));\r\n        this.canAddContact = false;\r\n        this.typeList.push(this.form.value.type);\r\n        this.contactList.push(this.form.value.contact);\r\n        (_a = this.form.get('type')) === null || _a === void 0 ? void 0 : _a.setValue(\"\");\r\n        (_b = this.form.get('contact')) === null || _b === void 0 ? void 0 : _b.setValue(\"\");\r\n        this.type.nativeElement.value = \"\";\r\n        this.contact.nativeElement.value = \"\";\r\n    }\r\n    deleteContact(i) {\r\n        this.typeList.splice(i, 1);\r\n        this.contactList.splice(i, 1);\r\n        const typeArray = this.form.get('typeList');\r\n        const contactArray = this.form.get('contactList');\r\n        typeArray.removeAt(i);\r\n        contactArray.removeAt(i);\r\n    }\r\n    //Visualización de la imagen\r\n    capturarFile(event) {\r\n        const archivoCapturado = event.target.files[0];\r\n        this.file = event.target.files[0]; //Se alamcena la imagen en el atributo file\r\n        this.extraerBase64(archivoCapturado).then((imagen) => {\r\n            this.previsualizacion = imagen.base;\r\n        });\r\n    }\r\n    sendbusiness(event) {\r\n        event.preventDefault();\r\n        const value = this.form.value;\r\n    }\r\n};\r\n__decorate([\r\n    ViewChild('type')\r\n], NewBusinessComponent.prototype, \"type\", void 0);\r\n__decorate([\r\n    ViewChild('contact')\r\n], NewBusinessComponent.prototype, \"contact\", void 0);\r\n__decorate([\r\n    ViewChild(\"placesRef\")\r\n], NewBusinessComponent.prototype, \"placesRef\", void 0);\r\nNewBusinessComponent = __decorate([\r\n    Component({\r\n        selector: 'app-new-business',\r\n        templateUrl: './new-business.component.html',\r\n        styleUrls: ['./new-business.component.css']\r\n    })\r\n], NewBusinessComponent);\r\nexport { NewBusinessComponent };\r\n"]},"metadata":{},"sourceType":"module"}